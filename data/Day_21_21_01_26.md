# Day 21, 21.01.2026  
Protocol writer: Lisa

---

## __Introduction__  
Todayâ€™s session focused on merging DataFrames (with inner, left, right, and outer joins as well as horizontal or vertical concatenation), using multiple penguins datasets.

We worked on two different exercises, one about Berlin bike thefts using a new package called geopandas, and one to combine dataframes.

---

## __Schedule__
| Time | Notes |
|---|---|
| 09:00 - 11:30 | Time for Career |
| 11:30 - 12:00 | Previous day's protocol |
| 12:00 - 13:00 | Lunch Break |
| 13:00 - 14:00 | Previous day's exercises |
| 14:00 - 16:00 | Merging DataFrames |
| 16:00 - EOD | Group work on exercises |

---
### __Concatenation__
- **Functionality:** Concatenation (```pd.concat()```) is performed along a **specified axis** (horizontal or vertical), with the option to apply set logic on the other axes. This allows for the *vertical* or *horizontal* merging of DataFrames, depending on the data organization and the desired outcome.
- **Usage:** 
    - **Vertical concatenation (```(axis=0)```):** DataFrames are stacked **on top of each other**. This is the default behavior and is typically used when the DataFrames have the **same columns but additional rows** of data that you want to append. 
        - Penguin example: Cataloging more penguins, but with the same data categories (=columns)
    - **Horizontal concatenation(```(axis=1)```):** Aligns DataFrames **side by side**, adding columns. We choose this when the DataFrames share the **same rows (observations) but contain different sets of features or variables**.
        - Penguin example: Collecting more data categories (like "age") about the same individual penguins (=rows)
    - Concatenation is not limited to two DataFrames
    - Key Parameters:
        - ```axis```: Determines direction of the concatenation. Default is 0, so will stack dataframes on top of each other.
        - ```ignore_index``` (Boolean): Set to True, this parameter ignores the existing index labels and creates a new range of integer indices (to avoid duplicate indices or if index does not carry meaningful information)
        - ```sort``` (Boolean): Controls whether to *sort* the columns (alphabetically) if concatenating along axis=0 (vertically), when the DataFrames have non-aligned columns. Can help identify similar columns and align the data appropriately.

---

## __Merging DataFrames with ```pd.merge()```__ 
Merging/ combining DataFrames allows for the integration of related data from multiple sources into a __single, cohesive dataset__. Merging happens two dataframes at a time, but can be chained.

  ðŸ”‘ **Important**: For all four merges, the DataFrames need **at least one *Key Columns* common to both** DataFrames which acts as the *join key*, enabling pandas to determine how to align matching rows across the two DataFrames (```on=[KEY_COLUMN_NAME]```). 

There are __four major types__ of merging DataFrames:

![Different types of Joins](/images/join_types.png)


### __Inner Join__  

- **Objective:** To combine two DataFrames based on **common keys**, retaining only the rows that have **matching values** in both original datasets.
- **Usage:** Merging data that shares a **common identifier** and looking only for **observations present in both DataFrames**. It ensures that the resulting DataFrame contains only the intersecting set of entries. The order of the DataFrames matters.

**Example:** </br>
Method 1:
```python
pd.merge(df1, df2, how='inner', on='species')
```
Method 2:
```python
df1.merge(df2, how='inner', on='species')
```

---

### __Right Join__  

- **Objective:** Merging two DataFrames using **all keys from the right DataFrame** and matching keys from the left DataFrame. No match? The *left* side will contain null. 
Right Join and Left Join require you to decide on a main dataframe you want to fully include in the new, merged one.
- **Usage:** Ensuring that *all* records from the **right** DataFrame are retained in the merge, filling in missing matches from the left DataFrame with NaNs. It is particularly helpful in cases where the right DataFrame holds a reference or a complete set of observations.

**Example:** </br>
Method 1:
```python
pd.merge(right=df1, left=df2, how='right', on='species')
```
Method 2:
```python
# note how the order in this syntax is important!
df2.merge(df1, how='right', on='species')
```

---

### __Left Join__  

- **Objective:** Similarly to right join, **all keys from the left DataFrame** are retained, and matching keys from the right DataFrame are used to merge the data. No match? The *right* side will contain null. 
- **Usage:** Suitable when the *left* DataFrame contains a set of records you want to preserve in the merge, filling in missing data from the right DataFrame where matches are found.


**Example:** </br>
Method 1:
```python
pd.merge(right=df1, left=df2, how='left', on='species')
```
Method 2:
```python
df2.merge(df1, how='left', on='species')
```

---

### __Outer/ Full Join__  

- **Objective:** Merging two DataFrames in their entirety. This method ensures that **all records from both DataFrames** are included in the resulting dataset, filling in missing matches with NaNs.
- **Usage:** The outer join is ideal when you want a comprehensive merge that **retains all entries from both DataFrames**, providing a complete picture of the available data, even if it means including rows with missing data. Important: it still needs a common key column to merge on. 

**Example:** </br>
Method 1: 
```python
pd.merge(right=df1, left=df2, how='outer', on='species')
```
Method 2:
```python
df1.merge(df2, how='outer', on='species')
```

#### __Helpful:__ ```indicator=True```  
- To add a column that shows you which original DataFrame a column is coming from, you can use ```indicator=True```. This will create the column ```_merge``` with values ```both```, ```right_only```, or ```left_only```. This works in both merge methods.
---
## __Join with__ ```pd.join()```
```pd.join()```is usually used to join two DataFrames on their shared **index** (with the same four join types). It *can* also use key columns like ```pd.merge()``` if you set them as index, but for details, read more in the [documentation](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.join.html). 

### __Sidenote (from the exercise): geopandas__
The ```geopandas``` package we used in the Berlin bike theft exercise allows handling of geospatial data, see [more](https://geopandas.org/)

---
## __Key Takeaways__

- ```pd.concat()``` allows stacking full dataframes on top of each other or next to each other even when they have no column in common
- ```pd.merge()```allows for four different types of join (inner, outer, right, and left) on a specified **column key**
- ```pd.join()```allows to join two dataframes on the **index** as the common column key
